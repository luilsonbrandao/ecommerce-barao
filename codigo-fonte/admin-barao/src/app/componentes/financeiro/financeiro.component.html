<div class="container-fluid mt-4 mb-5">
  <div class="row mb-3 border-bottom pb-2">
    <div class="col-12">
      <h3 class="fw-bold text-success m-0"><i class="fas fa-hand-holding-usd me-2"></i> Fluxo Financeiro e Repasses</h3>
    </div>
  </div>

  <div class="card shadow-sm border-0">
    <div class="card-body p-0 table-responsive" style="max-height: 70vh; overflow-y: auto;">
      <table class="table table-hover table-striped table-sm m-0 align-middle" style="font-size: 0.85rem;">
        <thead class="table-dark" style="position: sticky; top: 0; z-index: 1;">
          <tr>
            <th class="ps-3">SEQ</th>
            <th>Pedido</th>
            <th>Cliente (WhatsApp)</th>
            <th class="text-center">Parcela</th>
            <th class="text-center">Vencimento</th>
            <th class="text-end">V. Bruto</th>
            <th>Forma Pgto</th>
            <th class="text-end text-danger">Retenção</th>
            <th class="text-end text-success">V. Líquido</th>
            <th class="text-center">Status</th>
            <th class="text-center pe-3">Ação</th>
          </tr>
        </thead>
        <tbody>
          @for (ITEM of lista; track ITEM.numSeq) {
            <tr [ngClass]="{'opacity-50 text-decoration-line-through': ITEM.status === -1}">
              <td class="ps-3 fw-bold">{{ ITEM.numSeq }}</td>
              <td class="fw-bold text-primary">#{{ ITEM.idPedido }}</td>
              <td>
                <div class="fw-semibold">{{ ITEM.nomeCliente }}</div>
                <div class="text-muted small"><i class="fab fa-whatsapp text-success"></i> {{ ITEM.telefone }}</div>
              </td>
              <td class="text-center fw-bold">{{ ITEM.numParcela }} / {{ ITEM.totalParcelas }}</td>
              <td class="text-center">{{ ITEM.dataVencimento | date : 'dd/MM/yyyy' }}</td>
              <td class="text-end fw-bold">{{ ITEM.valorBruto | currency: 'BRL' }}</td>
              <td><span class="badge bg-light text-dark border">{{ ITEM.formaPagamento }}</span></td>

              <td class="text-end text-danger fw-bold" title="{{ ITEM.percentRetencao }}% de taxa">
                - {{ ITEM.valorRetencao | currency: 'BRL' }}
              </td>

              <td class="text-end text-success fw-bold fs-6">{{ ITEM.valorReceber | currency: 'BRL' }}</td>

              <td class="text-center">
                @if (ITEM.status === 0) { <span class="badge bg-warning text-dark"><i class="fas fa-hourglass-half"></i> PEND</span> }
                @else if (ITEM.status === 1) { <span class="badge bg-success"><i class="fas fa-check-double"></i> PAGO</span> }
                @else { <span class="badge bg-danger"><i class="fas fa-times"></i> CANC</span> }
              </td>

              <td class="text-center pe-3">
                <div class="btn-group btn-group-sm" role="group">
                  <button type="button" class="btn btn-outline-success" title="Marcar como Pago" (click)="alterarStatus(ITEM, 1)" [disabled]="ITEM.status === 1 || ITEM.status === -1">
                    <i class="fas fa-check-circle"></i>
                  </button>
                  <button type="button" class="btn btn-outline-warning" title="Voltar para Pendente" (click)="alterarStatus(ITEM, 0)" [disabled]="ITEM.status === 0 || ITEM.status === -1">
                    <i class="fas fa-undo"></i>
                  </button>
                  <button type="button" class="btn btn-outline-danger" title="Cancelar Lançamento" (click)="alterarStatus(ITEM, -1)" [disabled]="ITEM.status === -1">
                    <i class="far fa-trash-alt"></i>
                  </button>
                </div>
              </td>
            </tr>
          } @empty {
            <tr><td colspan="11" class="text-center py-4 text-muted">Nenhum registro financeiro encontrado.</td></tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
