<div class="container-fluid mt-4 mb-5">
  <div class="row mb-3 border-bottom pb-2">
    <div class="col-12">
      <h3 class="fw-bold text-success"><i class="fas fa-address-book me-2"></i> Relatório de Clientes</h3>
    </div>
  </div>

  <div class="d-flex flex-wrap gap-2 justify-content-center mb-4 bg-light p-2 rounded border">
    <a [routerLink]="['/clientes']" class="fw-bold text-decoration-none">TODOS</a>
    @for (LETRA of listaLetras; track LETRA) {
      <a [routerLink]="['/clientes']" [queryParams]="{letra: LETRA}" class="text-decoration-none fw-bold text-secondary px-1">{{ LETRA }}</a>
    }
  </div>

  <div class="row mb-4 justify-content-between align-items-center">
    <div class="col-md-6 d-flex gap-2">
      <input type="text" [(ngModel)]="keyword" class="form-control" placeholder="Digite o nome para busca...">
      <button class="btn btn-primary" (click)="buscarPorPalavraChave()"><i class="fas fa-search"></i> Buscar</button>
    </div>
    <div class="col-md-3 text-end mt-3 mt-md-0">
      <button class="btn btn-warning fw-bold text-dark shadow-sm" (click)="adicionarNovoCliente()"><i class="fas fa-user-plus me-1"></i> Novo Cliente</button>
    </div>
  </div>

  <div class="card shadow-sm border-0 table-responsive">
    <table class="table table-hover table-striped m-0 align-middle">
      <thead class="table-dark">
        <tr><th class="ps-3">Nome</th><th>Data Nasc</th><th>WhatsApp</th><th>Email</th><th>Endereço</th></tr>
      </thead>
      <tbody>
        @for (CLI of lista; track CLI.idCliente) {
          <tr>
            <td class="ps-3 fw-semibold text-primary">
              <a href="javascript:void(0)" class="text-decoration-none" (click)="exibirCliente(CLI)">
                <i class="far fa-edit me-1"></i> {{ CLI.nome }}
              </a>
              @if (isBirthday(CLI.dataNasc)) { <i class="fas fa-birthday-cake text-warning ms-2" title="Aniversariante do Dia!"></i> }
            </td>
            <td>{{ CLI.dataNasc | date : 'dd/MM/yyyy' }}</td>
            <td>{{ CLI.telefone }}</td>
            <td>{{ CLI.email }}</td>
            <td class="small text-muted">
              {{ CLI.logradouro }}, {{ CLI.numero }} {{ CLI.complemento }}<br>
              {{ CLI.bairro }} - {{ CLI.cidade }}/{{ CLI.estado }}
            </td>
          </tr>
        } @empty {
          <tr><td colspan="5" class="text-center py-4 text-muted">Nenhum cliente encontrado.</td></tr>
        }
      </tbody>
    </table>
  </div>
</div>

@if (detalhe) {
  <div class="modal d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title fw-bold"><i class="fas fa-user-edit me-2"></i> {{ isNovoCliente ? 'Novo Cliente' : 'Editar Cliente' }}</h5>
          <button type="button" class="btn-close btn-close-white" (click)="fecharModal()"></button>
        </div>
        <div class="modal-body">
          <h6 class="fw-bold border-bottom pb-1 text-secondary">Dados Pessoais</h6>
          <div class="row g-2 mb-3">
            <div class="col-md-8">
              <label class="small fw-bold">Nome do Cliente</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.nome">
            </div>
            <div class="col-md-4">
              <label class="small fw-bold">CPF</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.cpf" placeholder="Apenas números">
            </div>
            <div class="col-md-5">
              <label class="small fw-bold">Email</label>
              <input type="email" class="form-control form-control-sm" [(ngModel)]="detalhe.email">
            </div>
            <div class="col-md-3">
              <label class="small fw-bold">Nascimento</label>
              <input type="date" class="form-control form-control-sm" [(ngModel)]="detalhe.dataNasc">
            </div>
            <div class="col-md-4">
              <label class="small fw-bold">Telefone/WhatsApp</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.telefone">
            </div>
          </div>

          <h6 class="fw-bold border-bottom pb-1 text-secondary mt-4">Endereço</h6>
          <div class="row g-2">
            <div class="col-md-4">
              <label class="small fw-bold">CEP</label>
              <div class="input-group input-group-sm">
                <input type="text" class="form-control" [(ngModel)]="detalhe.cep">
                <button class="btn btn-outline-success" (click)="buscarCEP()"><i class="fas fa-search"></i></button>
              </div>
            </div>
            <div class="col-md-8">
              <label class="small fw-bold">Logradouro (Rua, Av.)</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.logradouro">
            </div>
            <div class="col-md-2">
              <label class="small fw-bold">Número</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.numero">
            </div>
            <div class="col-md-4">
              <label class="small fw-bold">Complemento</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.complemento">
            </div>
            <div class="col-md-6">
              <label class="small fw-bold">Bairro</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.bairro">
            </div>
            <div class="col-md-9">
              <label class="small fw-bold">Cidade</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.cidade">
            </div>
            <div class="col-md-3">
              <label class="small fw-bold">Estado</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="detalhe.estado">
            </div>
          </div>
        </div>
        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-secondary" (click)="fecharModal()">Cancelar</button>
          <button type="button" class="btn btn-success fw-bold" (click)="salvarCliente()">
            <i class="fas fa-save me-1"></i> Salvar Dados
          </button>
        </div>
      </div>
    </div>
  </div>
}
